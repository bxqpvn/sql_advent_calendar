-- SQL Advent Calendar - Day 3
-- Title: The Grinch's Best Pranks Per Target
-- Difficulty: hard
--
-- Question:
-- The Grinch has brainstormed a ton of pranks for Whoville, but he only wants to keep the top prank per target, with the highest evilness score. Return the most evil prank for each target. If two pranks have the same evilness, the more recently brainstormed wins.
--
-- The Grinch has brainstormed a ton of pranks for Whoville, but he only wants to keep the top prank per target, with the highest evilness score. Return the most evil prank for each target. If two pranks have the same evilness, the more recently brainstormed wins.
--

-- Table Schema:
-- Table: grinch_prank_ideas
--   prank_id: INTEGER
--   target_name: VARCHAR
--   prank_description: VARCHAR
--   evilness_score: INTEGER
--   created_at: TIMESTAMP
--

-- My Solution:

with most_evil_pranks as
  (select 
  prank_id,
  target_name,
  prank_description,
  evilness_score,
  created_at,
  ROW_NUMBER() over (
    PARTITION by target_name
    order by evilness_score desc, created_at desc
  ) recent_and_evilness
from grinch_prank_ideas
)
select
  prank_id,
  target_name,
  prank_description,
  evilness_score,
  created_at
from most_evil_pranks
where recent_and_evilness = 1
